(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var a=0;a<t.length;a++){var d=t[a];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(e,i(d.key),d)}}function i(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var d=a.call(t,i||"default");if("object"!=e(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==e(i)?i:i+""}var a=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=null,this.selectedWidgetId=null,this.selectedSidebarId=null,this.isDragging=!1},i=[{key:"saveWidget",value:function(e){var t=this;if(e.length>0){var i=[];$.each(e.find("li[data-id]"),function(e,t){i.push($(t).find("form").serialize())}),$httpClient.make().post(BWidget.routes.save_widgets_sidebar,{items:i,sidebar_id:e.data("id")}).then(function(i){var a=i.data;e.find("ul").html(a.data),t.updateWidgetCount(e),Botble.callScroll($(".list-page-select-widget")),Botble.initResources(),Botble.initMediaIntegrate(),Botble.initTreeCheckboxes(),window.Botble&&window.Botble.initCoreIcon(),$(document).trigger("widgets:reloaded"),Botble.showSuccess(a.message)}).finally(function(){e.find(".widget-save i").remove()})}}},{key:"updateWidgetCount",value:function(e){var t=e.find(".widget-item").length,i=e.find(".widget-area-count");i.length&&i.text(t)}},{key:"updateAllWidgetCounts",value:function(){var e=this;$(".sidebar-item").each(function(t,i){e.updateWidgetCount($(i))})}},{key:"showStep1",value:function(){$("#widget-add-step-1").show(),$("#widget-add-step-2").hide(),$("#widget-add-form-container").html('<div class="widget-add-loading"><div class="spinner-border spinner-border-sm text-primary" role="status"></div><span class="ms-2 text-muted">Loading...</span></div>')}},{key:"showStep2",value:function(e){$("#widget-add-step-1").hide(),$("#widget-add-step-2").show(),$("#widget-add-sidebar-name").text(e)}},{key:"loadWidgetForm",value:function(e,t){$httpClient.make().get(BWidget.routes.get_widget_form,{widget_id:e,sidebar_id:t}).then(function(e){var t=e.data;$("#widget-add-form-container").html(t.data.form),Botble.initResources(),Botble.initMediaIntegrate(),Botble.initTreeCheckboxes(),window.Botble&&window.Botble.initCoreIcon()}).catch(function(){$("#widget-add-form-container").html('<div class="alert alert-danger mb-0"><div class="d-flex"><svg xmlns="http://www.w3.org/2000/svg" class="icon alert-icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /><path d="M12 8v4" /><path d="M12 16h.01" /></svg><div>Failed to load widget form. Please try again.</div></div></div>')})}},{key:"addWidgetToSidebar",value:function(){var e=$("#widget-add-modal-sidebar-id").val(),t=$("#widget-add-modal-widget-id").val();if(t&&e){var i=$('.sidebar-item[data-id="'.concat(e,'"]'));if(0!==i.length){var a=$("#widget-add-form").serialize(),d=$('#wrap-widget-1 li[data-id="'.concat(t,'"]'));if(0!==d.length){var n=d.clone();new URLSearchParams(a).forEach(function(e,t){var i=n.find('[name="'.concat(t,'"]'));i.length?i.is(":checkbox")||i.is(":radio")?i.prop("checked","1"===e||"on"===e||e===i.val()):i.val(e):n.find("form").append('<input type="hidden" name="'.concat(t,'" value="').concat(e,'">'))});var o=i.find("ul");o.find(".widget-dropzone").remove(),o.append(n),this.saveWidget(i),this.modal.hide(),this.showStep1()}}}}},{key:"initWidgetSearch",value:function(){var e=$("#widget-search"),t=$("#wrap-widget-1"),i=$("#widget-search-empty");e.length&&(e.on("input",function(){var e=$(this).val().toLowerCase().trim(),a=0;t.find(".widget-source-item").each(function(){var t=($(this).data("name")||"").includes(e);$(this).toggle(t),t&&a++}),0===a&&e.length>0?(t.hide(),i.show()):(t.show(),i.hide())}),e.on("keydown",function(e){"Escape"===e.key&&$(this).val("").trigger("input")}))}},{key:"initDragIndicator",value:function(){var e=this;$(document).on("sortstart",function(){e.isDragging=!0,$("#wrap-widgets").addClass("dragging-active")}).on("sortstop",function(){e.isDragging=!1,$("#wrap-widgets").removeClass("dragging-active")})}},{key:"init",value:function(){var e=this,t=[{name:"wrap-widgets",pull:"clone",put:!1}];$.each($(".sidebar-item"),function(){t.push({name:"wrap-widgets",pull:!0,put:!0})}),t.forEach(function(t,i){var a=document.getElementById("wrap-widget-"+(i+1));a&&Sortable.create(a,{sort:0!==i,group:t,delay:0,disabled:!1,store:null,animation:200,easing:"cubic-bezier(0.25, 1, 0.5, 1)",handle:".widget-draggable-handler",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",dataIdAttr:"data-id",forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,scroll:!0,scrollSensitivity:50,scrollSpeed:10,onStart:function(){e.isDragging=!0,$("#wrap-widgets").addClass("dragging-active")},onEnd:function(){e.isDragging=!1,$("#wrap-widgets").removeClass("dragging-active")},onUpdate:function(t){t.from!==t.to&&e.saveWidget($(t.from).closest(".sidebar-item")),e.saveWidget($(t.item).closest(".sidebar-item"))},onAdd:function(t){t.from!==t.to&&e.saveWidget($(t.from).closest(".sidebar-item")),e.saveWidget($(t.item).closest(".sidebar-item"))}})}),$("#wrap-widgets").on("click",".widget-control-delete",function(t){t.preventDefault();var i=$(t.currentTarget),a=i.closest("li");Botble.showButtonLoading(i),$httpClient.make().delete(BWidget.routes.delete,{widget_id:a.data("id"),position:a.data("position"),sidebar_id:i.closest(".sidebar-item").data("id")}).then(function(t){var a=t.data;Botble.showSuccess(a.message);var d=i.closest(".sidebar-item");d.find("ul").html(a.data),e.updateWidgetCount(d),window.Botble&&(window.Botble.initResources(),window.Botble.initMediaIntegrate(),window.Botble.initCoreIcon()),$(document).trigger("widgets:reloaded")}).finally(function(){Botble.showButtonLoading(a.find(".widget-control-delete"))})}).on("click",".widget-item .widget-item-header",function(t){if(!e.isDragging){var i=$(t.target);if(!i.closest(".widget-item-toggle").length&&!i.is(".widget-item-toggle")){var a=$(t.currentTarget);e.toggleWidgetContent(a)}}}).on("click",".widget-item-toggle",function(t){if(t.preventDefault(),t.stopPropagation(),!e.isDragging){var i=$(t.currentTarget).closest(".widget-item-header");e.toggleWidgetContent(i)}}).on("click",".widget-save",function(t){t.preventDefault();var i=$(t.currentTarget);Botble.showButtonLoading(i),e.saveWidget(i.closest(".sidebar-item"))}).on("click",".widget-add-btn",function(t){t.preventDefault(),t.stopPropagation();var i=$(t.currentTarget);e.selectedWidgetId=i.data("widget-id"),$("#widget-add-modal-widget-id").val(e.selectedWidgetId),e.showStep1(),e.modal||(e.modal=new bootstrap.Modal(document.getElementById("widget-add-modal"))),e.modal.show()}),$(document).on("click",".widget-sidebar-option",function(t){t.preventDefault();var i=$(t.currentTarget),a=i.data("sidebar-id"),d=i.data("sidebar-name"),n=$("#widget-add-modal-widget-id").val();n&&a&&(e.selectedSidebarId=a,$("#widget-add-modal-sidebar-id").val(a),e.showStep2(d),e.loadWidgetForm(n,a))}),$(document).on("click","#widget-add-back",function(t){t.preventDefault(),e.showStep1()}),$(document).on("click","#widget-add-submit",function(t){t.preventDefault(),e.addWidgetToSidebar()}),$("#widget-add-modal").on("hidden.bs.modal",function(){e.showStep1()}),this.initWidgetSearch(),this.updateAllWidgetCounts()}},{key:"toggleWidgetContent",value:function(e){var t=e.closest(".widget-item"),i=t.find(".widget-item-content");t.toggleClass("is-expanded"),i.slideToggle(250,function(){$(this).toggleClass("show")})}}],i&&t(e.prototype,i),a&&t(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i,a}();$(function(){(new a).init()})})();